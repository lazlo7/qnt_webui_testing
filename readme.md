# Тестирование web-интерфейса приложения SBTS

Тестирование интерфейса веб-приложения с помощью `Selenium`, `pytest` и `ChromeDriver`.

# Как запустить тесты?

## Запуск сервера приложения SBTS
Запустите сервер приложения `SBTS` с помощью `docker compose`:
```
docker compose up -d
```

## Запуск самих тестов

### Nix-системы
Для `nix` систем доступен flake `flake.nix`, который автоматически настраивает окружение и предоставляет оболочку разработчика одной командой:
```
nix develop
```

Затем тесты можно запустить командой:
```
pytest webui
```

### Другие системы

#### 1\. Установка Google Chrome
На системе должен быть установлен браузер `Google Chrome` и доступен в `$PATH`.  
Также можно самостоятельно указать путь к браузеру, задав переменную окружения `CHROME_PATH`.

#### 2\. Установка ChromeDriver
Для работы тестов с браузером на системе должен быть установлен движок `ChromeDriver`.
Многие репозитории предоставляют пакет `chromedriver`, который может быть установлен и добавлен в `$PATH` пакетным менеджером системы.  
Например, для `Arch Linux` `chromedriver` досупен в `AUR`:
```
paru -S chromedriver
```
Также можно самостоятельно указать путь к движку, задав переменную окружения `CHROMEDRIVER_PATH`.

#### 3\. Установка selenium, pytest и запуск тестов
С помощью `poetry`:
```
poetry install
```
Затем тесты можно запустить командой:
```
poetry run pytest webui
``` 

Или же с помощью `pip`:
```
pip -r requirements.txt
```
Затем тесты можно запустить командой:
```
pytest webui
```

Перед запуском тестов можно указать значение переменной окружения `TESTING_URL` - ссылки, к которой будет подключаться браузер (по умолчанию - `http://localhost:8091/`)

Ожидается, что все тесты провалятся, что сообщит о найденных ошибках.

## Найденные ошибки

### Ошибка #1

**Раздел**  
2\. Описание модели и режима перемещения

**Описание**  
Перемещаемый корабль может выйти за предел или переместиться на место левого ограничителя (расположенного на координате -20), при быстром нажатии на кнопку перемещения влево, что запрещено правилами ТЗ.

**Тест**  
Проверяется тестом `test_moving_past_left_boundary()`.

### Ошибка #2

**Раздел**  
2\. Описание модели и режима перемещения

**Описание**  
Текущий корабль может перемещаться на произвольное число клеток за время таймера перемещения, что позволяет пермещаться на более чем одну клетку за две секунды, хотя ТЗ заявяет, что ограничение на время перемещения на одну клетку должно составлять не менее двух секунд.

**Тест**  
Используется тест `test_moving_during_timer()`, где проверяется что кнопка может быть нажата во время таймера перемещения и таймер обновится, а также что мы дейстивтельно оказались более чем на одной клетке от начальной позиции за меньшее время.
